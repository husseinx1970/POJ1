<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark only"/>
  <title>Utby Snabb Bilservice — Pålitlig bilservice i Göteborg</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#DABD66">
  <style>
    /* ---------- Styles (kept from your design) ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;background:#0b0c10;color:#f6f7fb;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    img{max-width:100%;display:block}
    a{color:#DABD66;text-decoration:none}
    .container{width:min(1100px,100%);margin:auto;padding:0 18px}

    /* Header */
    .header{position:sticky;top:0;z-index:10;background:rgba(12,13,18,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.1)}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:64px;height:64px;border-radius:12px;object-fit:contain;filter:drop-shadow(0 0 12px rgba(218,189,102,.3))}
    .brand-name{font:800 18px/1 Space Grotesk;color:#fff}
    .nav{display:flex;gap:8px}
    .nav a{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:700;font-size:14px;border:1px solid rgba(255,255,255,.12);line-height:1}
    .nav a.secondary{background:rgba(255,255,255,.06);color:#fff}
    .nav a:not(.secondary){background:#DABD66;color:#111}

    /* Hero */
    h1{font-family:Space Grotesk,Inter;font-weight:800;font-size:clamp(26px,6vw,40px);background:linear-gradient(90deg,#fff,#DABD66);-webkit-background-clip:text;color:transparent;margin:.6em 0}
    .lead{color:#C9D2DE;max-width:65ch;margin:0 auto 16px}
    .btn{padding:9px 14px;border-radius:12px;font-weight:800;font-size:14px;border:1px solid rgba(255,255,255,.1)}
    .btn.primary{background:#DABD66;color:#111}
    .btn.ghost{background:rgba(255,255,255,.06);color:#fff}

    /* Contact form */
    .section{padding:35px 0}
    .contact-form{display:grid;gap:10px;max-width:560px;margin:20px auto;padding:20px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:14px}
    .contact-form h3{text-align:center;font:800 20px/1.3 Space Grotesk;margin:0 0 15px;color:#fff}
    label{font-weight:600;font-size:13px;color:#e6e8ef}
    input,textarea,select{width:100%;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05);color:#fff;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    input:focus,textarea:focus,select:focus{border-color:#d9b954;outline:none;box-shadow:0 0 0 2px rgba(218,189,102,.18)}
    button[type="submit"]{margin-top:6px;padding:12px 14px;border-radius:999px;background:linear-gradient(180deg,#e9cf6e,#d4b848);color:#111;font-weight:800;font-size:15px;border:none;cursor:pointer}
    #contactStatus{margin-top:12px;padding:10px;border-radius:8px;text-align:center;display:none}
    #contactStatus.success{background:rgba(34,197,94,.12);color:#4ade80;border:1px solid rgba(34,197,94,.25)}
    #contactStatus.error{background:rgba(239,68,68,.08);color:#f87171;border:1px solid rgba(239,68,68,.2)}
    #contactStatus.info{background:rgba(255,215,90,.06);color:#f6e7b8;border:1px solid rgba(218,189,102,.12)}
    .inline-dt{display:grid;grid-template-columns:repeat(2,minmax(140px,1fr));gap:8px;align-items:end;margin-top:4px}
    @media(max-width:520px){.inline-dt{grid-template-columns:1fr}}
  </style>
</head>
<body>

  <header class="header">
    <div class="container header-inner">
      <a class="brand" href="#start"><img src="assets/logo.png" alt="logo"/><span class="brand-name">Utby Snabb Bilservice</span></a>
      <nav class="nav">
        <a class="secondary" href="#tjanster">Tjänster</a>
        <a class="secondary" href="#kontakt">Kontakt</a>
        <a href="#boka">Boka tid</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="section" id="start">
      <div class="container">
        <h1>Professionell bilservice i Göteborg</h1>
        <p class="lead">Komplett service, reparation och diagnos för alla bilmärken. Drop-in välkommen — vardagar 09:00–18:00.</p>
      </div>
    </section>

    <section class="section" id="boka">
      <div class="container">
        <h2 style="text-align:center;color:#fff;margin-bottom:12px">Kontakt oss & Boka tid</h2>

        <div class="contact-form">
          <h3>Boka tid</h3>

          <!-- FORM: using EmailJS only -->
          <form id="contactForm" novalidate>
            <input type="text" name="_honey" style="display:none" autocomplete="off">

            <label for="name">Namn</label>
            <input id="name" name="name" placeholder="För- och efternamn" required>

            <label for="contactPhone">Telefon (valfritt)</label>
            <input id="contactPhone" name="phone" type="tel" placeholder="072-123 45 67">

            <label for="email">E-post</label>
            <input id="email" name="email" type="email" placeholder="din@epost.se" required>

            <label for="car">Bil/Regnr</label>
            <input id="car" name="car" placeholder="Ex: ABC123 eller Volvo V60 2017">

            <label for="issueInput">Problem / Tjänst</label>
            <input type="text" id="issueInput" name="issue" placeholder="Välj eller sök tjänst..." autocomplete="off">

            <div class="inline-dt">
              <div>
                <label for="date">Önskat datum</label>
                <input id="date" name="date" type="date">
              </div>
              <div>
                <label for="time">Önskad tid</label>
                <input id="time" name="time" type="time">
              </div>
            </div>

            <label for="contactMessage">Meddelande</label>
            <textarea id="contactMessage" name="message" placeholder="Berätta vad du behöver hjälp med..."></textarea>

            <button type="submit">Skicka meddelande</button>

            <!-- Status element: only updated by our JS (no raw fetch errors shown) -->
            <div id="contactStatus" role="status" aria-live="polite"></div>
          </form>
        </div>

        <div style="text-align:center;margin-top:18px;color:#C9D2DE">
          <p>Vagnmakaregatan 2, 415 72 Göteborg</p>
        </div>
      </div>
    </section>
  </main>

  <!-- EmailJS library -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
  /************************************************
   *  IMPORTANT: Replace these with your EmailJS values
   *  - EMAILJS_PUBLIC_KEY:   your user/public key
   *  - EMAILJS_SERVICE_ID:   your service id (e.g. service_xxx)
   *  - EMAILJS_TEMPLATE_ID:  your template id (e.g. template_xxx)
   ************************************************/
  const EMAILJS_PUBLIC_KEY = "vt_iAWB9MVGz6iT_X";
  const EMAILJS_SERVICE_ID = "service_6fai64h";
  const EMAILJS_TEMPLATE_ID = "template_7tccbsi";

  // Init EmailJS (if library loaded)
  if (window.emailjs && typeof emailjs.init === 'function') {
    try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch (e) { console.warn('emailjs.init failed', e); }
  } else {
    console.warn('EmailJS library not available yet.');
  }

  // helper: set min date
  (function setMinDate() {
    const dateInput = document.getElementById('date');
    if (!dateInput) return;
    const today = new Date();
    const y = today.getFullYear();
    const m = String(today.getMonth() + 1).padStart(2, '0');
    const d = String(today.getDate()).padStart(2, '0');
    dateInput.min = `${y}-${m}-${d}`;
  })();

  /**
   * showStatus(type, text)
   * type: 'info' | 'success' | 'error' | ''
   */
  function showStatus(type, text) {
    const el = document.getElementById('contactStatus');
    if (!el) return;
    el.style.display = 'block';
    el.className = '';
    if (type === 'success') el.classList.add('success');
    else if (type === 'error') el.classList.add('error');
    else el.classList.add('info');
    el.textContent = text;
  }

  /**
   * prepareTemplateParams(form)
   * maps form fields to template variables used in EmailJS template
   */
  function prepareTemplateParams(form) {
    const name = (form.querySelector('[name="name"]') || {}).value || '';
    const email = (form.querySelector('[name="email"]') || {}).value || '';
    const phone = (form.querySelector('[name="phone"]') || {}).value || '';
    const regnr = (form.querySelector('[name="car"]') || {}).value || '';
    const problem = (form.querySelector('[name="issue"]') || {}).value || '';
    const date = (form.querySelector('[name="date"]') || {}).value || '';
    const time = (form.querySelector('[name="time"]') || {}).value || '';
    const message = (form.querySelector('[name="message"]') || {}).value || '';

    return {
      from_name: name,
      email: email,
      phone: phone,
      regnr: regnr,
      problem: problem,
      date: date,
      time: time,
      message: message
    };
  }

  /**
   * sendWithEmailJS(form)
   * Use EmailJS only. Returns Promise.
   */
  function sendWithEmailJS(form) {
    return new Promise((resolve, reject) => {
      // honeypot check
      const honey = form.querySelector('input[name="_honey"]');
      if (honey && honey.value.trim() !== '') {
        return reject(new Error('Bot suspected'));
      }

      // ensure keys set
      if (!EMAILJS_PUBLIC_KEY || !EMAILJS_SERVICE_ID || !EMAILJS_TEMPLATE_ID) {
        return reject(new Error('EmailJS keys not configured'));
      }

      const params = prepareTemplateParams(form);
      showStatus('info', 'Skickar e-post...');

      // call EmailJS
      if (!window.emailjs || typeof emailjs.send !== 'function') {
        return reject(new Error('EmailJS library missing'));
      }

      emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params)
        .then(function(resp) {
          resolve(resp);
        }, function(err) {
          reject(err);
        });
    });
  }

  // Attach submit handler (EmailJS only; no fetch)
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contactForm');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      // HTML5 validation
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      try {
        await sendWithEmailJS(form);
        showStatus('success', 'Tack! Ditt meddelande har skickats. Vi återkommer så snart som möjligt.');
        form.reset();
      } catch (err) {
        console.error('EmailJS send error:', err);
        // Friendly error message - NO raw "Failed to fetch" shown to user
        const msg = (err && err.text) ? ('Fel: ' + err.text) : 'Kunde inte skicka meddelandet just nu. Försök igen senare eller ring oss.';
        showStatus('error', msg);
        // optional: do NOT attempt fetch backup automatically (to avoid "Failed to fetch")
        // if you want a backup, implement server-side proxy or enable FormSubmit on server.
      }
    });
  });
  </script>
</body>
</html>
