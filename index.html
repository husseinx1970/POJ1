<!-- EmailJS library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
(function(){
  // EmailJS configuration — ändra om du har andra värden
  const EMAILJS_PUBLIC_KEY = "vt_iAWB9MVGz6iT_X";
  const EMAILJS_SERVICE_ID = "service_6fai64h";
  const EMAILJS_TEMPLATE_ID = "template_7tccbsi";

  // init
  if (window.emailjs && typeof emailjs.init === 'function') {
    try { emailjs.init(EMAILJS_PUBLIC_KEY); } catch (e) { console.warn('emailjs.init failed', e); }
  }

  // helper för status
  function setStatus(text, state) {
    const el = document.getElementById('contactStatus_emailjs') || document.getElementById('contactStatus');
    if (!el) return;
    el.textContent = text;
    el.className = state === 'ok' ? 'success' : (state === 'error' ? 'error' : '');
    el.style.display = 'block';
  }

  // submit handler för EmailJS-formuläret (form id: contactForm_emailjs)
  document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('contactForm_emailjs');
    if (!form) return;

    form.addEventListener('submit', async function(e){
      e.preventDefault();
      // validity
      if (!form.checkValidity()) { form.reportValidity(); return; }

      const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
      const originalText = submitBtn ? (submitBtn.textContent || submitBtn.value) : null;
      if (submitBtn) { submitBtn.disabled = true; if (submitBtn.tagName.toLowerCase()==='button') submitBtn.textContent = 'Skickar...'; }

      setStatus('', null);

      try {
        await emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, form);
        setStatus('Tack! Ditt meddelande har skickats. Vi återkommer så snart som möjligt.', 'ok');
        form.reset();
        // show thanks modal if present
        const thanksModal = document.getElementById('thanksModal');
        if (thanksModal) { thanksModal.classList.add('show'); document.body.classList.add('scroll-lock'); }
      } catch (err) {
        const msg = (err && (err.text || err.message)) ? (err.text || err.message) : 'E-post kunde inte skickas via EmailJS.';
        setStatus(msg, 'error');
        console.error('EmailJS error:', err);
      } finally {
        if (submitBtn) { submitBtn.disabled = false; if (submitBtn.tagName.toLowerCase()==='button') submitBtn.textContent = originalText; }
      }
    });
  });
})();
</script>